<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OopisOS v3.0 User Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #18181b; /* zinc-900 */
            color: #e4e4e7; /* zinc-200 */
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .nav-link { transition: all 0.3s ease; }
        .nav-link.active, .nav-link:hover {
            background-color: #3f3f46; /* zinc-700 */
            color: #a7f3d0; /* emerald-200 */
        }
        h1, h2, h3, h4 {
            font-family: 'VT323', monospace;
            letter-spacing: 0.05em;
        }
        h1 { color: #34d399; /* emerald-400 */ margin-bottom: 0.75rem; }
        h2 {
            color: #60a5fa; /* blue-400 */
            border-bottom: 1px solid #52525b; /* zinc-600 */
            padding-bottom: 0.25rem;
            margin-top: 1.75rem;
            margin-bottom: 1.25rem;
        }
        h3 { color: #facc15; /* yellow-400 */ margin-top: 1.25rem; margin-bottom: 0.75rem; }
        h4 { color: #fb923c; /* orange-400 */ margin-top: 1rem; margin-bottom: 0.5rem; }
        .content-section p, .content-section li { line-height: 1.7; margin-bottom: 1rem; }
        a { color: #2dd4bf; /* teal-400 */ text-decoration: underline; }
        a:hover { color: #5eead4; /* teal-300 */ }
        pre {
            background-color: #27272a; /* zinc-800 */
            color: #d4d4d8; /* zinc-300 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'VT323', monospace;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.5;
            margin-top: 0.75rem;
            margin-bottom: 1.25rem;
        }
        code {
            font-family: 'VT323', monospace;
            background-color: #3f3f46; /* zinc-700 */
            color: #fde047; /* yellow-300 */
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
        pre code { padding: 0; background-color: transparent; color: inherit; }
        .sidebar { background-color: #27272a; /* zinc-800 */ }
        .main-content { background-color: #18181b; /* zinc-900 */ }
        .logo { font-family: 'VT323', monospace; color: #34d399; /* emerald-400 */ }
        table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
        th, td { border: 1px solid #52525b; /* zinc-600 */ padding: 0.75rem; text-align: left; }
        th { background-color: #3f3f46; /* zinc-700 */ font-family: 'VT323', monospace; color: #a7f3d0; /* emerald-200 */ }
        .content-section ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .content-section ol { list-style-type: decimal; margin-left: 1.5rem; margin-bottom: 1rem; }
        .terminal-example {
            background-color: #0d0d0d; /* darker than zinc-950 */
            border: 2px solid #3f3f46; /* zinc-700 */
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1.25rem;
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.1);
        }
        .terminal-example .prompt { color: #60a5fa; /* blue-400 */ }
        .terminal-example .command { color: #a7f3d0; /* emerald-200 */ }
        .terminal-example .output { color: #e4e4e7; /* zinc-200 */ white-space: pre-wrap; }
        .footer { border-top: 1px solid #52525b; /* zinc-600 */ padding-top: 1rem; margin-top: 2rem; font-size: 0.875rem; color: #a1a1aa; /* zinc-400 */ }
        #menu-button { display: none; }
        @media (max-width: 768px) {
            #menu-button { display: block; }
            .sidebar { display: none; width: 100%; height: auto; position: static; }
            .sidebar.open { display: block; }
        }
    </style>
</head>
<body class="min-h-screen">

<div class="flex flex-col md:flex-row min-h-screen">
    <button id="menu-button" class="md:hidden p-4 bg-zinc-800 text-emerald-400 fixed top-0 left-0 z-20">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
    </button>

    <aside class="sidebar w-full md:w-64 lg:w-72 p-6 space-y-4 fixed md:sticky top-0 h-screen overflow-y-auto z-10">
        <h1 class="logo text-4xl mb-6">OopisOS</h1>
        <nav>
            <ul class="space-y-2">
                <li><a href="#home" class="nav-link block p-3 rounded-lg active">Home & Overview</a></li>
                <li><a href="#user-guide" class="nav-link block p-3 rounded-lg">User Guide</a></li>
                <li><a href="#advanced-topics" class="nav-link block p-3 rounded-lg">Advanced Topics</a></li>
                <li><a href="#developer-docs" class="nav-link block p-3 rounded-lg">Developer Docs</a></li>
                <li><a href="#testing-env" class="nav-link block p-3 rounded-lg">Testing & Showcase</a></li>
                <li><a href="#about" class="nav-link block p-3 rounded-lg">About & Credits</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content flex-1 p-6 md:p-10 overflow-y-auto mt-16 md:mt-0">
        <section id="home" class="content-section active">
            <h1>Welcome to OopisOS v3.0: The Keystone Release</h1>
            <p class="text-lg mt-2 mb-6 text-zinc-400">Security, Power, and Stability. Welcome to the machine, perfected.</p>

            <div class="terminal-example">
                <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">echo "OopisOS is ready."</span><br>
                <span class="output">OopisOS is ready.</span>
            </div>

            <h2>What is OopisOS v3.0?</h2>
            <p>OopisOS is a sophisticated OS simulation that runs entirely within your browser. It's a self-contained, persistent world built on a foundation of privacy and exploration, featuring a rich command-line environment, a secure multi-user file system, and a suite of powerful integrated tools. All user data is stored locally in your browser; your world remains your own.</p>
            <p>The "Keystone" release marks a new era of maturity for the system. The foundations have been fortified, the tools sharpened, and the security model made ironclad. This is OopisOS as it was always meant to be: a powerful, reliable, and secure environment for learning and creation.</p>

            <h2>Key Features at a Glance</h2>
            <ul class="list-disc ml-6 my-4 space-y-2">
                <li><strong>A Rock-Solid File System:</strong> A persistent VFS powered by IndexedDB with a full suite of management tools: `ls`, `find`, `tree`, `diff`, `cp`, `mv`, and `rm`. New in v3.0: `zip` and `unzip` for file archival.</li>
                <li><strong>An Empowered Command-Line:</strong> Full history, tab-completion, piping (`|`), redirection (`>`), backgrounding (`&`), sequencing (`;`), and environment variable support.</li>
                <li><strong>A True Multi-User Security Model:</strong> Create users (`useradd`) and groups (`groupadd`). Manage permissions with `chmod`, `chown`, and `chgrp`. New in v3.0: Execute commands with elevated privileges using `sudo` and safely edit the rules with `visudo`.</li>
                <li><strong>A Full Suite of Applications:</strong>
                    <ul>
                        <li>`edit`: A powerful text editor with live Markdown preview.</li>
                        <li>`paint`: A character-based art studio for your inner artist.</li>
                        <li>`adventure`: A text-adventure game engine.</li>
                        <li>`chidi`: An AI-powered document analysis tool.</li>
                        <li>`gemini`: A tool-using AI assistant for your terminal.</li>
                    </ul>
                </li>
                <li><strong>System & Session Management:</strong> Save and restore your entire session state with `savestate` and `loadstate`, or create full system `backup` files for transfer.</li>
            </ul>
        </section>

        <section id="user-guide" class="content-section">
            <h1>User Guide</h1>
            <p>This guide covers the essential commands for navigating and interacting with the OopisOS environment. For a quick list of all commands, type <code>help</code>. For a detailed manual on a specific command, type <code>man [command_name]</code>.</p>

            <h2>Essential Commands</h2>
            <table class="min-w-full divide-y divide-zinc-700">
                <thead>
                <tr>
                    <th class="px-4 py-2">Command & Key Flags</th>
                    <th class="px-4 py-2">What It Does</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-zinc-800">
                <tr><td><code>help [cmd]</code></td><td>Displays a list of commands or a command's basic syntax.</td></tr>
                <tr><td><code>ls [-l -a -R -r -t -S -X -d]</code></td><td>Lists directory contents. The cornerstone of observation.</td></tr>
                <tr><td><code>tree [-L level] [-d]</code></td><td>Like `ls`, but fancier. Displays files and directories in a tree structure.</td></tr>
                <tr><td><code>cd [directory]</code></td><td>Changes your current location in the file system.</td></tr>
                <tr><td><code>pwd</code></td><td>Prints the full path of your current working directory.</td></tr>
                <tr><td><code>mkdir [-p] [dir_name]</code></td><td>Creates a new, empty directory.</td></tr>
                <tr><td><code>cat [file...]</code></td><td>Displays the entire content of a file.</td></tr>
                <tr><td><code>echo [text]</code></td><td>Repeats text back to you. Primarily used for writing to files.</td></tr>
                <tr><td><code>touch [file]</code></td><td>Creates a new empty file or updates the timestamp of an existing one.</td></tr>
                <tr><td><code>rm [-r -f -i] [item]</code></td><td>Removes (deletes) a file or directory. This is permanent.</td></tr>
                <tr><td><code>cp [-r -f -p -i] [src] [dest]</code></td><td>Copies a file or directory.</td></tr>
                <tr><td><code>mv [-f -i] [src] [dest]</code></td><td>Moves or renames a file or directory.</td></tr>
                <tr><td><code>diff [file1] [file2]</code></td><td>Compares two files and shows the differences.</td></tr>
                <tr><td><code>grep [-i -v -n -c -R] [pat] [file]</code></td><td>Searches for a text pattern within files.</td></tr>
                <tr><td><code>find [path] [expr]</code></td><td>A powerful tool to find files based on various criteria.</td></tr>
                </tbody>
            </table>

            <h2>Application Suite</h2>
            <p>OopisOS comes with several built-in applications that run in a full-screen, modal interface, providing a richer experience than standard command-line tools.</p>
            <h3><code>edit [file]</code></h3>
            <p>Opens the OopisOS text editor. It's a surprisingly capable editor with features like live Markdown and HTML preview (`Ctrl+P`), a formatting toolbar, and keyboard shortcuts for saving (`Ctrl+S`) and exiting (`Ctrl+O`).</p>
            <h3><code>paint [file.oopic]</code></h3>
            <p>Unleash your creativity with the character-based art editor. It features a full canvas, multiple tools (pencil, eraser, shapes), a color palette, and saves your work to the custom `.oopic` format.</p>
            <h3><code>chidi [path]</code></h3>
            <p>The AI Librarian. Point `chidi` at a directory of Markdown files (`.md`) to open a dedicated reading interface. Here, you can ask the AI to summarize documents, generate study questions, or perform a query across all loaded documents to find specific information.</p>
            <h3><code>adventure [file.json]</code></h3>
            <p>Launches the text adventure game engine. You can play the default built-in game or load your own custom adventures from a `.json` file.</p>
        </section>

        <section id="advanced-topics" class="content-section">
            <h1>Advanced Topics</h1>
            <p>Ready to wield true power? This section covers the tools that separate the administrators from the users.</p>

            <h2>Privilege Escalation: `sudo` and `visudo`</h2>
            <p>Not all users are created equal. Some tasks, like installing software or modifying critical system files, require the power of the `root` user. The `sudo` command is your key to borrowing that power, safely and temporarily.</p>
            <h4><code>sudo [command]</code></h4>
            <p>The `sudo` (superuser do) command executes a single command with `root` privileges. The first time you use `sudo`, you will be prompted for *your own* password to verify your identity. If successful, a timestamp is recorded, and you won't need to enter your password again for a set period (typically 15 minutes).</p>
            <div class="terminal-example">
                <span class="prompt">Guest@OopisOs:~$</span> <span class="command">sudo chmod 777 /etc/motd</span><br>
                <span class="output">[sudo] password for Guest: ******</span><br>
                <span class="output"># The command is now executed as root.</span>
            </div>

            <h4><code>visudo</code></h4>
            <p>Who gets to use `sudo`? That's controlled by the <code>/etc/sudoers</code> file. You must **never** edit this file directly with `edit`. The `visudo` command is the only safe way to modify it. It opens the file in the editor but adds a lock to prevent multiple simultaneous edits and, more importantly, performs a syntax check on save to prevent you from locking yourself out of the system.
            </p>
            <p><strong>Permissions:</strong> Only the `root` user can run `visudo`.</p>
            <pre><code class="language-bash">
# /etc/sudoers example
# Give the user 'admin' full root privileges
admin    ALL

# Allow anyone in the 'testers' group to run the 'reboot' command
%testers reboot
            </code></pre>

            <h2>File Archival: `zip` and `unzip`</h2>
            <p>Manage collections of files by bundling them into a single archive.</p>
            <h4><code>zip [archive.zip] [path_to_zip]</code></h4>
            <p>Creates a simulated `.zip` archive containing the file or directory at the specified path. This is a recursive operation that preserves the directory structure within the archive.</p>
            <h4><code>unzip [archive.zip] [destination_path]</code></h4>
            <p>Extracts the contents of a `.zip` archive into the specified destination directory. If no destination is provided, it extracts to the current directory.</p>
            <div class="terminal-example">
                <span class="prompt">Guest@OopisOs:~$</span> <span class="command">zip my_project_backup.zip /home/Guest/projects/alpha</span><br>
                <span class="output">Successfully zipped '/home/Guest/projects/alpha' to 'my_project_backup.zip'.</span><br>
                <span class="prompt">Guest@OopisOs:~$</span> <span class="command">unzip my_project_backup.zip /home/Guest/backups/</span><br>
                <span class="output">Archive 'my_project_backup.zip' successfully extracted to '/home/Guest/backups/'.</span>
            </div>
        </section>

        <section id="developer-docs" class="content-section">
            <h1>Developer Documentation</h1>
            <p>The OopisOS v3.0 "Keystone" release introduces a new, highly modular command architecture. This design is a core component of the system's stability and makes adding new commands a secure and straightforward process. This is a brief overview; for the full architectural document, please see <code>/docs/developer.md</code>.</p>

            <h2>The Command Contract</h2>
            <p>Adding a new command is a declarative process. Instead of writing boilerplate validation logic, you *declare* your command's requirements to the `CommandExecutor`. The executor enforces these rules *before* your command's core logic is ever run. This is a critical security and stability feature.</p>

            <p>The contract is defined in a single object and includes:</p>
            <ul class="list-disc ml-6 my-4 space-y-2">
                <li><code>flagDefinitions</code>: All flags the command accepts (e.g., `-v`, `--verbose`).</li>
                <li><code>argValidation</code>: The number of arguments your command expects (e.g., min, max, exact).</li>
                <li><code>pathValidation</code>: Which arguments are file paths and what type they should be (`file` or `directory`).</li>
                <li><code>permissionChecks</code>: Which permissions (`read`, `write`, `execute`) the user must have on those paths.</li>
            </ul>

            <h2>Example: Creating a New Command</h2>
            <p>Here is the standard pattern for creating a new command file in <code>/scripts/commands/</code>.</p>
            <pre><code class="language-javascript">
// scripts/commands/mycommand.js
(() => {
    "use strict";

    const myCommandDefinition = {
        commandName: "mycommand",
        // 1. Define the contract
        argValidation: { exact: 1 },
        pathValidation: [{ argIndex: 0, options: { expectedType: 'file' } }],
        permissionChecks: [{ pathArgIndex: 0, permissions: ['read'] }],

        // 2. Write the core logic, trusting the context is pre-validated
        coreLogic: async (context) => {
            const { validatedPaths } = context;
            const pathInfo = validatedPaths[0]; // Guaranteed to be a valid, readable file.
            return { success: true, output: `File content: ${pathInfo.node.content}` };
        }
    };

    const description = "A brief summary for 'help'.";
    const helpText = "Usage: mycommand &lt;file&gt;...";

    // 3. Register it with the system
    CommandRegistry.register("mycommand", myCommandDefinition, description, helpText);
})();
            </code></pre>
            <p>After creating the file, simply add a <code>&lt;script&gt;</code> tag for it in <code>index.html</code> (after `registry.js` and before `commexec.js`), and your command will be available on the next boot.</p>

        </section>
        <section id="testing-env" class="content-section">
            <h1>Testing & Showcase Environment</h1>
            <p>A brand new OS can feel... empty. To combat this digital loneliness and give you something to immediately play with, we've included two very special scripts.</p>

            <h2>The World-Builder: `inflate.sh`</h2>
            <p>Think of this as the ultimate demo disk. A single command that terraforms your empty home directory into a bustling ecosystem of files, directories, and secrets, all designed for you to test, abuse, and explore.</p>
            <p>Just run this command to create your new world:</p>
            <div class="terminal-example">
                <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">run /extras/inflate.sh</span>
            </div>

            <h2>The Gauntlet: `diag.sh`</h2>
            <p>This is our quality assurance department, packed into a single script. It's a relentless stress test that runs a barrage of commands to ensure the OS doesn't melt into a puddle of ones and zeros under pressure. It's a comprehensive suite that tests the entire v3.0 feature set, including the new administrative (`sudo`) and file management (`zip`/`unzip`) commands. It is the definitive way to confirm all systems are operational.</p>
            <div class="terminal-example">
                <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">run /extras/diag.sh</span>
            </div>
        </section>
        <section id="about" class="content-section">
            <h1>About & Credits</h1>
            <p>You've reached the end of the manual. If you're still reading, you're either a developer, a completionist, or hopelessly lost. In any case, here's the story behind the machine and the legal fine print that gives it its soul.</p>

            <h2>The Creators</h2>
            <p>OopisOS is the unlikely result of a caffeine-and-code-fueled fever dream, a collaboration between:</p>
            <ul class="list-disc ml-6 my-4 space-y-2">
                <li><strong>Andrew Edmark</strong> (The Human Element, Chief Architect)</li>
                <li><strong>Gemini</strong> (The AI Assistant, Humble Narrator, and Primary Cause of Bugs-Turned-Features)</li>
            </ul>

            <h2>The Social Contract (aka The Boring Legal Bit)</h2>
            <p>Yes, even a simulated OS in a browser tab needs a license. This one is special. It's an MIT license at its core, but with an extended preamble to acknowledge the beautiful weirdness of its creation. Here is the spirit of the agreement:</p>

            <h3>Preamble</h3>
            <p>This Software, OopisOS, represents a collaborative endeavor between human direction and artificial intelligence.</p>
            <p><strong>Copyright (c) 2025 Andrew Edmark (hereinafter referred to as the "Curator")</strong></p>

            <h3>Authorship and Contribution Acknowledgment</h3>
            <p>This Software was developed by the Curator through a process of interactive collaboration with Google's Gemini, an artificial intelligence language model (the "AI Assistant"). The Curator provided the initial concepts, creative direction, iterative prompts, critical review, testing, and the selection of the final form of the Software. The AI Assistant, under the explicit direction and oversight of the Curator, contributed to the generation, drafting, and composition of portions of the code and associated documentation.</p>

            <h3>License Grant</h3>
            <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
            <ul class="list-disc ml-6 my-2">
                <li>The above copyright notice, the Authorship and Contribution Acknowledgment, and this permission notice shall be included in all copies or substantial portions of the Software.</li>
            </ul>

            <h3>Disclaimer of Warranty</h3>
            <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS (INCLUDING THE CURATOR) OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
        </section>
        <footer class="footer text-center">
            <p>&copy; 2025 Andrew Edmark & Gemini. OopisOS User-Friendly Manual (v3.0).</p>
        </footer>
    </main>
</div>
<script>
    const navLinks = document.querySelectorAll('.nav-link');
    const contentSections = document.querySelectorAll('.content-section');
    const sidebar = document.querySelector('.sidebar');
    const menuButton = document.getElementById('menu-button');

    function updateActiveSection() {
        const hash = window.location.hash || '#home';
        navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === hash);
        });
        contentSections.forEach(section => {
            section.classList.toggle('active', section.id === hash.substring(1));
        });
        document.querySelector('.main-content').scrollTop = 0;
        if (sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function () {
            if (this.getAttribute('href').startsWith('#')) {
                if (window.location.hash === this.getAttribute('href')) {
                    document.querySelector('.main-content').scrollTop = 0;
                }
            }
        });
    });

    menuButton.addEventListener('click', () => {
        sidebar.classList.toggle('open');
    });

    window.addEventListener('hashchange', updateActiveSection);
    updateActiveSection();
</script>
</body>
</html>